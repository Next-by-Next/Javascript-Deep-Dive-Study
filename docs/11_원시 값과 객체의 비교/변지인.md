## 원시 값과 객체의 비교

**오늘 읽은 범위** : 11장 전체

### 0. 원시 값과 객체의 비교

---

#### _원시 값과 객체_

자바스크립트가 제공하는 7가지 데이터 타입(`숫자`,`문자열`,`불리언`,`null`,`undefined`,`심벌`,`객체타입`)은 크게 원시타입(primitive type)과 객체타입(object/reference type)으로 구분할 수 있다.

#### _차이점_

1\) **변경**

\- 원시 값: 변경 불가능한 값(immutable value)

\- 객체타입 값 : 변경 가능한 값(mutable value)

2\) **저장**

\- 원시 값: 변수에 할당 시 변수(확보된 메모리 공간)에는 실제 값 저장

\- 객체타입 값 : 변수에 할당 시 변수(확보된 메모리 공간)에는 참조 값 저장

3\) **전달**

\- 원시 값: 다른 변수를 할당하면 원본의 원시값이 복사 되어 전달 => 값에 의한 전달(pass by value)

\- 객체타입 값 : 다른 변수를 할당하면 원본의 참조값이 복사 되어 전달 => 참조값에 의한 전달(pass by reference)

#### _공통점_

식별자가 기억하는 메모리 공간에 저장되어 있는 값을 복사해서 전달한다는 면이 같다.

### 1. 원시 값

---

#### _변경 불가능한 값_

한번 생성된 원시 값은 읽기 전용(read only)값으로서 변경할 수 없다. `변경 불가능하다는 값은 변수가 아니라 값에 대한 진술`이다. 즉, 원시 값 자체를 변경할 수 없다는 말이지 변수를 변경할 수 없다는 말이 아니다. 상수 또한 마찬가지로 원시 값과는 상관 없다.

\- 변수 : 변하는 값

\- 상수 : 변수의 상대개념. 재할당이 금지된 변수. 상수도 값을 저장하기 위한 메모리 공간이 필요함.

- 불변성(immutability) : 변수 값을 변경하기 위해 원시값을 재할당 하면 새로운 메모리 공간을 확보하고 재할당한 값을 저장한 후, 변수가 참조하던 메모리 공간의 주소를 변경하는 특성이다.

**원시값은 변경 불가능한 값**
<img width="577" alt="스크린샷 2023-11-11 134048" src="https://github.com/Next-by-Next/Javascript-Deep-Dive-Study/assets/129635857/24905915-62d2-499e-a595-7ee57859405d">

**원시값은 변경 가능한 값**
<img width="869" alt="스크린샷 2023-11-11 132848" src="https://github.com/Next-by-Next/Javascript-Deep-Dive-Study/assets/129635857/eebd36ff-df5d-49f7-9ea9-936dc1819aba">

\+ 불변성을 갖는 원시 값을 할당한 변수는 재할당 이외에 변수 값을 변경할 수 없다

#### _문자열과 불변성_

원시 타입별로 메모리 공간의 크기가 미리 정해져 있다. 단, ESMAscript 사양에 문자열 타입(2바이트)와 숫자 타입(8바이트) 이외는 명확히 규정되지 않아 제조사에 따라 다를 수 있다.

그 중 문자열은 다른 원시 값과 비교할 때 독특한 특징이 있다. 문자열 자체가 `문자의 집합`이기 때문에, 1개의 문자는 2바이트의 메모리 공간에 저장된다. 예를 들어 숫자의 경우 값이 1도, 1000도 8바이트에 저장 되지만, 문자열은 1은 2바이트, 1000은 2000바이트가 필요(=문자의 갯수에 따라 다름)하다.

문자열은 `유사 배열 객체`이면서 `이터러블`이므로 배열과 유사하게 각 문자에 접근할 수 있다.

- 유사 배열 객체(array-like object) : 마치 배열처럼 인덱스로 프로퍼티 값에 접근할 수 있고 length 프로퍼티를 갖는 객체를 말한다. 인덱스를 통해 문자에 접근할 수 있으며, length 프로퍼티를 갖기 때문에 배열 객체이고 for문으로 순회할 수도 있다.

```JavaScript
var str = 'String';
//문자열은 유사 배열이므로 배열과 유사하게 인덱스를 사용해 각 문자에 접근할 수 있다
console.log(str[0]); // S
//원시값인 문자열이 객체처럼 동작한다.
console.log(str.length); // 6
console.log(str.toUpperCase()); // STRING
```

#### _값에 의한 전달_

엄격하게 표현하면 변수에는 값이 전달 되는 것이 아니라 메모리 주소가 전달되기 때문에, 식별자는 값이 아니라 `메모리 주소`를 기억한다. 즉, 식별자는 메모리 주소에 붙인 이름이라고 할 수 있다. `전달된 메모리 주소를 통해 메모리 공간에 접근하면 값을 참조할 수 있다.`

중요한 것은 변수에 원시 값을 갖는 변수를 할당하면 변수 할당 시점이든, 두 변수 중 어느 하나의 변수에 값을 재할당하는 시점이든 `결국은 두 변수의 원시 값은 서로 다른 메모리 공간에 저장된 별개의 값이 되어 어느 한쪽에서 재할당을 통해 값을 변경하더라도 서로 간섭할 수 없다는 것`이다.

**값에 의해 전달된 값은 다른 메모리 공간에 저장된 별개의 값이다**
<img width="480" alt="스크린샷 2023-11-12 030940" src="https://github.com/Next-by-Next/Javascript-Deep-Dive-Study/assets/129635857/dafab5bb-1401-48cc-9a51-01a999a68ece">
=>두 변수가 기억하는 메모리 주소가 다르다

**변수에 원시값을 갖는 변수를 할당하는 시점에는 두 변수가 같은 원시값을 참조하다가 어느 한쪽의 변수에 재할당이 이뤄졌을 때 비로소 새로운 메모리 공간에 재할당된 값을 저장하는 경우**
<img width="467" alt="스크린샷 2023-11-12 031220" src="https://github.com/Next-by-Next/Javascript-Deep-Dive-Study/assets/129635857/76e7e872-2ad2-4e54-bdc5-bb4d72e07811">
=>두 변수가 기억하는 메모리 주소가 같다

### 2. 객체

---

#### _자바스크립트 객체의 관리 방식_

프로퍼티 키를 인덱스로 사용하는 `해시 테이블(hash table)`이라고 생각할 수 있다.(=연관배열(associative array,map,dictionary,lookup table))

자바스크립트 엔진에서는 프로퍼티에 접근하기 위해 동적탐색(dynamic lookup) 대신 히든클래스(hidden class)라는 방식을 사용해 성능을 보장한다.

#### _변경 가능한 값_

`메모리를 효율적`으로 사용하기 위해, 객체를 복사해 생성하는 `비용을 절약`하여 성능을 향상 시키기 위해 객체는 변경 가능한 값으로 설계되어 있다.

\- 얕은 복사 : 객체를 프로퍼티 값으로 갖는 객체의 경우, 한단계까지만 복사

\- 깊은 복사 : 객체를 프로퍼티 값으로 갖는 객체의 경우, 객체에 중첩되어 있는 객체까지 모두 복사

```JavaScript
const o = { x: { y: 1 } };

// 얕은 복사
const c1 = { ...o }; // 35장 "스프레드 문법" 참고
console.log(c1 === o); // false
console.log(c1.x === o.x); // true

// lodash의 cloneDeep을 사용한 깊은 복사
// "npm install lodash"로 lodash를 설치한 후, Node.js 환경에서 실행
const _ = require('lodash');
// 깊은 복사
const c2 = _.cloneDeep(o);
console.log(c2 === o); // false
console.log(c2.x === o.x); // false
```

#### _참조에 의한 전달_

`객체를 할당한 변수에는 생성된 객체가 실제로 저장된 메모리 공간의 주소가 저장`되어 있는데 이를 참조값이라고 한다. 변수는 참조값을 통해 객체에 접근할 수 있다.

객체는 원시값과는 다르게 여러 개의 식별자가 하나의 객체를 공유할 수 있는데, 이로인해 참조값이 복사되는 부작용이 발생한다.

참조값이 복사되면 `두 개의 식별자가 하나의 객체`를 공유하기 때문에 프로퍼티 추가, 삭제때 서로 영향을 받는다.

**참조에 의한 전달**
<img width="534" alt="스크린샷 2023-11-12 035127" src="https://github.com/Next-by-Next/Javascript-Deep-Dive-Study/assets/129635857/8f65c03f-8ff6-41f9-82ec-ccaf9ebb2a38">
