## 13장 스코프

<br>

### 13.1 스코프란?

---

```js
var var1 = 1; // 코드의 가장 바깥 영역에서 선언한 변수

if (true) {
  var var2 = 2; // 코드 블록 내에서 선언한 변수
  if (true) {
    var var3 = 3; // 중첩된 코드 블록 내에서 선언한 변수
  }
}

function foo() {
  var var4 = 4; // 함수 내에서 선언한 변수
  function bar() {
    var var5 = 5; // 중첩된 함수 내에서 선언한 변수
  }
}

console.log(var1); // 1
console.log(var2); // 2
console.log(var3); // 3
console.log(var4); // ReferenceError: var4 is not defined
console.log(var5); // ReferenceError: var5 is not defined
```

모든 식별자(변수 이름, 함수 이름, 클래스 이름 등)는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정되는데 이를 **스코프**라 한다.

```js
var x = "global";

function foo() {
  var x = "local";
  console.log(x); // 1
}

foo();

console.log(x); // 2
```

코드 가장 바깥 영역과 `foo` 함수 내부에 같은 이름을 갖는 `x` 변수를 선언했고 자바스크립트 엔진은 이 두 개의 변수 중에서 어떤 변수를 참조할지 정해야 하는데 이를 식별자 결정이라 한다.
위 예시에서 코드의 가장 바깥 영역에 선언된 `x`와 `foo` 함수 내부에서 선언된 `x` 변수는 이름이 같지만, **스코프가 다른 별개의 변수**다.

<br>

### 13.2 스코프의 종류

---

코드는 전역과 지역으로 구분할 수 있다.

| 구분 |         설명          |   스코프    |   변수    |
| :--: | :-------------------: | :---------: | :-------: |
| 전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역 |    함수 몸체 내부     | 지역 스코프 | 지역 변수 |

#### 13.2.1 전역과 전역 스코프

전역이란 코드의 가장 바깥 영역을 발한다. 전역에 변수를 선언하면 전역 스코프를 갖는 변수가 되고 **전역 변수는 어디서든지 참조**할 수 있다.

<br>

#### 13.2.2 지역과 지역 스코프

지역이란 함수 몸체 내부를 말한다. 지역 변수는 자신이 선언된 지역과 하위 지역에서만 참조할 수 있다. 다시 말하면 **지역변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효**하다.

<br>

### 13.3 스코프 체인

---

함수는 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있는데 이는 스코프가 함수의 중첩때문에 계층적 구조를 갖는다는 의미이다.
이렇게 스코프가 계층적으로 연결된 것을 스코프 체인이라 한다.
변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.

<br>

#### 13.3.1 스코프 체인에 의한 변수 검색

스코프 체인을 따라 변수를 참조하는 코드의 스코프에서 시작해서 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다. 이는 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없는 뜻이다.

<br>

#### 13.3.2 스코프 체인에 의한 함수 검색

```js
// 전역 함수
function foo() {
  console.log("global function foo");
}

function bar() {
  // 중첩 함수
  function foo() {
    console.log("local function foo");
  }
  foo(); // 1
}

bar();
```

위 예시의 함수도 식별자에 해당되기 때문에 스코프를 갖는다. 따라서 1에서 foo 함수를 호출하면 local funtion foo를 출력한다.

<br>

### 13.4 함수 레벨 스코프

---

지역은 함수 몸체 내부를 말하고 지역은 스코프를 만드는데 이는 **코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다**는 의미이다.<br>
`var` 키워드로 선언된 변수는 오로지 **함수의 코드 블록(함수 몸체)만 지역 스코프로 인정**한다. 이러한 특성을 **함수 레벨 스코프**라 한다.

```js
var x = 1;

if(true){
  // var 키워드로 선언된 변수는 모두 전역 변수
  // 이미 선언된 전역 변수 x가 있으므로 x 변수는 중복선언
  // 변수 값이 변경되는 부작용 발생
  var x = 10;
}

console.log(x)l // 10
```

```js
var i = 10;

// for 문에서 선언한 i는 전역변수
// 이미 선언된 전역 변수 i가 있으므로 중복 선언
for (var i = 0; i < 5; i++) {
  console.log(i); // 0 1 2 3 4
}

// 의도치 않게 변수의 값 변경
console.log(i); // 5
```

<br>

### 13.5 렉시컬 스코프

---

```js
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo();
bar();
```

위 예시의 실행 결과는 `bar` 함수의 상위 스코프가 무엇인지에 따라 결정된다.

- **동적** 스코프: 함수를 어디서 호출했는지에 따라 함수의 상위 스코프를 결정한다.
- **렉시컬(정적)** 스코프: 함수를 어디서 정의했는지에 따라 함수의 상위 스코프를 결정한다.

**자바스크립트는 렉시컬 스코프를 따르므로 함수를 어디서 정의했는지에 따라 상위 스코프를 결정**한다.
함수가 호출된 위치는 상위 스코프 결정에 어떠한 영향도 주지 않는다.<br>
위 예시에서 `bar` 함수는 전역에서 정의된 함수이므로 전역 스코프를 상위 스코프로 사용한다. 따라서 `foo` 함수와 `bar` 함수의 호출 모두 1을 출력한다.
